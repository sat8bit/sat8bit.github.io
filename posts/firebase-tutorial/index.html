<!DOCTYPE html>
<html lang="ja"><meta charset="utf-8"><meta name="generator" content="Hugo 0.79.1" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<meta name="supported-color-schemes" content="light dark"><title>Firebase Tutorial&nbsp;&ndash;&nbsp;三日坊主。</title><link rel="stylesheet" href="/css/core.min.f50770753e7b4a1cf823b8241022bf5a6908ecbc3cfcba59bfb76af28f94cceda372fd3dad1f0b6fb6592fd79f9fc1f3.css" integrity="sha384-9QdwdT57Shz4I7gkECK/WmkI7Lw8/LpZv7dq8o&#43;UzO2jcv09rR8Lb7ZZL9efn8Hz"><meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Firebase Tutorial" /><body><section id="header">
    <div class="header wrap"><span class="header left-side"><a class="site home" href="/"><span class="site name">三日坊主。</span></a></span>
        <span class="header right-side"><div class="nav wrap"><nav class="nav"><a class="nav item" href="/categories/">カテゴリー</a><a class="nav item" href="/tags/">タグ</a></nav></div></span></div></section><section id="content"><div class="article-container"><section class="article header">
    <h1 class="article title">Firebase Tutorial</h1><p class="article date">2021-02-09</p></section><article class="article markdown-body"><h1 id="概要">概要</h1>
<p>Firebase を使って色々やるチュートリアル。</p>
<blockquote>
<p>Firebase は、高品質のアプリを迅速に開発できる Google のモバイル プラットフォームで、ビジネスの成長に役立ちます。</p>
</blockquote>
<h1 id="事前準備プロジェクトの作成と開発の準備">事前準備：プロジェクトの作成と開発の準備</h1>
<h2 id="プロジェクトの作成">プロジェクトの作成</h2>
<p>トップページから、プロジェクトを作る。</p>
<p><a href="http://console.firebase.google.com/">http://console.firebase.google.com/</a></p>
<p>愛着が湧く名前が良いと思う。今回は <code>matomelien</code> とした。まとめサイト関連のサービス作るの好き。</p>
<h2 id="リポジトリの整備">リポジトリの整備</h2>
<p><code>git</code> のリポジトリを整備していく。</p>
<p>Firebase では、一つのリポジトリに Firebase の各サービスに対するソースコードをまとめる構成がとれそうなので、まとめる。</p>
<pre><code>ROOT/
├── functions  // Firebase Functions
...
└── public     // Firebase Hosting
</code></pre><p>プロジェクト名でディレクトリを作って <code>git init .</code> しておく。</p>
<pre><code>$ mkdir matomelien
$ cd matomelien
$ git init .
</code></pre><p>以降はこのディレクトリをルートとする。</p>
<h2 id="firebase-cli-のインストール">Firebase CLI のインストール</h2>
<p>node 及び npm のインストール手順はここでは割愛する。</p>
<p>Global に firebase-tools をインストールしておく。</p>
<pre><code>$ npm install -g firebase-tools
</code></pre><p>以降は以下のバージョンを使って作業をしている。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ node --version
v14.14.0
$ npm --version
6.14.8
$ firebase --version
9.3.0
</code></pre></div><h2 id="プロジェクトの初期化">プロジェクトの初期化</h2>
<p>チュートリアルに沿って以下のコマンドでログインする。</p>
<pre><code>$ firebase login
</code></pre><h1 id="functions-で-api-を作る">Functions で API を作る</h1>
<p>今回は TypeScript を使う前提で進める。</p>
<p>ドキュメント：https://firebase.google.com/docs/functions/</p>
<h2 id="functions-の初期化">Functions の初期化</h2>
<p>以下のコマンドを実行する。</p>
<pre><code>firebase init functions
</code></pre><p>すると、まずどうやってプロジェクトを作成するか聞かれる。今回は既に <code>matomelien</code> を作成済なので、<code>Use an exists project</code> を選択。</p>
<pre><code>? Please select an option:
❯ Use an existing project
  Create a new project
  Add Firebase to an existing Google Cloud Platform project
  Don't set up a default project
</code></pre><p>ログインしているユーザに紐づく Project の一覧を出してくれるので、選択。上は typo したやつ。</p>
<pre><code>? Select a default Firebase project for this directory: (Use arrow keys)
  matomelian (matomelian)
❯ matomelien (matomelien)
</code></pre><p>言語選び。TypeScript を選択。</p>
<pre><code>? What language would you like to use to write Cloud Functions?
  JavaScript
❯ TypeScript
</code></pre><p>ESLint は私の場合は入れておく。</p>
<pre><code>? Do you want to use ESLint to catch probable bugs and enforce style? (Y/n)
</code></pre><p><code>npm install</code> していい？と聞かれるのでまぁそのまま OK。</p>
<pre><code>✔  Wrote functions/package.json
✔  Wrote functions/.eslintrc.js
✔  Wrote functions/tsconfig.json
✔  Wrote functions/tsconfig.dev.json
✔  Wrote functions/src/index.ts
✔  Wrote functions/.gitignore
? Do you want to install dependencies with npm now? (Y/n)
</code></pre><p>完了すると、雛形を一通り作成してくれる。これで初期化は完了。</p>
<h2 id="http-request-で起動する-hello-world-の-local-実行と-deploy">Http Request で起動する Hello World! の local 実行と Deploy</h2>
<p>functions/src/index.ts で export した function が deploy される。</p>
<p><code>functions/src/index.ts</code> にコメントアウトされた雛形があるので、このコメントアウトを外してみる。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-diff" data-lang="diff"> import * as functions from &#34;firebase-functions&#34;;

<span style="color:#f92672">-// // Start writing Firebase Functions
</span><span style="color:#f92672">-// // https://firebase.google.com/docs/functions/typescript
</span><span style="color:#f92672">-//
</span><span style="color:#f92672">-// export const helloWorld = functions.https.onRequest((request, response) =&gt; {
</span><span style="color:#f92672">-//   functions.logger.info(&#34;Hello logs!&#34;, {structuredData: true});
</span><span style="color:#f92672">-//   response.send(&#34;Hello from Firebase!&#34;);
</span><span style="color:#f92672">-// });
</span><span style="color:#f92672"></span><span style="color:#a6e22e">+// Start writing Firebase Functions
</span><span style="color:#a6e22e">+// https://firebase.google.com/docs/functions/typescript
</span><span style="color:#a6e22e">+
</span><span style="color:#a6e22e">+export const helloWorld = functions.https.onRequest((request, response) =&gt; {
</span><span style="color:#a6e22e">+  functions.logger.info(&#34;Hello logs!&#34;, {structuredData: true});
</span><span style="color:#a6e22e">+  response.send(&#34;Hello from Firebase!&#34;);
</span><span style="color:#a6e22e">+});
</span></code></pre></div><p>localhost で実行する前に TypeScript だと build してトランスパイルする必要があるので、行う。</p>
<p><a href="https://firebase.google.com/docs/functions/typescript?hl=ja#emulating_typescript_functions">https://firebase.google.com/docs/functions/typescript?hl=ja#emulating_typescript_functions</a></p>
<pre><code>$ cd functions
$ npm run build
</code></pre><p>成功したら、以下のコマンドを使って emulator を起動する。</p>
<pre><code>$ firebase emulators:start
（略）
✔  functions[helloWorld]: http function initialized (http://localhost:5001/matomelien/us-central1/helloWorld).
（略）
</code></pre><p>上の表にある URL にアクセスする。</p>
<p><img  src="/images/2021-02-09-22-47-04.png"
        alt/></p>
<p>動いてることが確認できたので、実際に本番にデプロイする。<br>
ここでエラーが。有料プランにあげてって言われている。前無料でできたのにな・・・</p>
<pre><code>$ firebase deploy --only functions
（略）
Error: Your project matomelien must be on the Blaze (pay-as-you-go) plan to complete this command. Reqthis command. Required API cloudbuild.googleapis.com can't be enabled until the upgras cograde, visit uired API cloudbuild.googleapis.com cde is complete. To upgrade, visit the following URL:

https://console.firebase.google.com/project/matomelien/usage/details
</code></pre><p>調べたら元々 <code>Node8</code> のランタイムを無料プランで提供してたけど、それが去年非推奨になって <code>Node10</code> 以降でしか使えなくなった。<br>
<code>Node10</code> 以降は Blaze（従量課金プラン）でしか提供していない模様。</p>
<p><a href="https://qiita.com/azukiazusa/items/edd6ca9cba2d48c4c3e2">https://qiita.com/azukiazusa/items/edd6ca9cba2d48c4c3e2</a></p>
<p>Pricing はここ。</p>
<p><a href="https://firebase.google.com/pricing">https://firebase.google.com/pricing</a></p>
</article><section class="article author"><p class="name">Satoshi Koizumi</p><div class="details"><a class="item" href="https://github.com/sat8bit" target="_blank" rel="noopener noreferrer"><span class="iconfont icon-github"></span>&nbsp;sat8bit</a><a class="item" href="https://twitter.com/sat8bit" target="_blank" rel="noopener noreferrer"><span class="iconfont icon-twitter"></span>&nbsp;@sat8bit</a><a class="item" href="mailto:sat8bit@mail.com" target="_blank" rel="noopener noreferrer"><span class="iconfont icon-email"></span>&nbsp;sat8bit@mail.com</a></div>
</section>
</div>
<div class="article bottom"><section class="article navigation"><p><a class="link" href="/posts/hugo-with-github-pages/"><span class="iconfont icon-article"></span>Hugo と Github Pages でブログを作る</a></p><p><a class="link" href="/posts/import-of-protocol-buffer/"><span class="iconfont icon-article"></span>Protocol Buffer の import におけるファイルの取扱いについて</a></p></section></div></section><section id="footer"><div class="footer-wrap">
    <p class="copyright">三日坊主。</p>
    <p class="powerby"><span>Powered&nbsp;by&nbsp;</span><a href="https://gohugo.io" 
        target="_blank" rel="noopener noreferrer">Hugo</a><span>&nbsp;&amp;&nbsp;</span><a href="https://themes.gohugo.io/hugo-notepadium/" 
        target="_blank" rel="noopener noreferrer">Notepadium</a></p></div>
</section>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-62G1T8FBSZ', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
</body>

</html>