<!doctype html><html lang=ja><head><meta charset=utf-8><title>Daily/2021/01/16</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-62G1T8FBSZ"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-62G1T8FBSZ');</script><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/rss+xml href=https://sat8bit.github.io/index.xml title=三日坊主。><meta property="og:title" content="Daily/2021/01/16"><meta property="og:description" content="Todo Todo Done daily のログのテンプレート作る o elasticsearch の検索優先度の検証したい - Log daily のログのテンプレート作る モニターが増えたのでなるべく作業ログを残すようにし"><meta property="og:type" content="article"><meta property="og:url" content="https://sat8bit.github.io/logs/daily-2021-01-16/"><meta property="article:published_time" content="2021-01-16T00:45:02+09:00"><meta property="article:modified_time" content="2021-01-16T00:45:02+09:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Daily/2021/01/16"><meta name=twitter:description content="Todo Todo Done daily のログのテンプレート作る o elasticsearch の検索優先度の検証したい - Log daily のログのテンプレート作る モニターが増えたのでなるべく作業ログを残すようにし"><link rel=stylesheet href=https://sat8bit.github.io/fontawesome/css/all.min.css><link id=dark-mode-theme rel=stylesheet href=https://sat8bit.github.io/css/dark.css><script>var darkTheme=document.getElementById('dark-mode-theme')
var storedTheme=localStorage.getItem('dark-mode-storage')
if(storedTheme==='dark'){darkTheme.disabled=false}else if(storedTheme==='light'){darkTheme.disabled=true}</script><script src=https://sat8bit.github.io/js/bundle.js></script><script src=https://sat8bit.github.io/js/instantpage.min.js type=module defer></script><meta name=generator content="Hugo 0.79.1"></head><body><header><nav class=navbar><div class=nav><a href=https://sat8bit.github.io/ class=nav-logo><img src=https://sat8bit.github.io/images/icon.png width=50 height=50 alt=Logo></a><ul class=nav-links><li><a href=/about/ id=About><em class="fas fa-user fa-lg"></em></a></li><li><a href=/tags id=Tags><em class="fas fa-tag fa-lg"></em></a></li><li><a href=/categories id=Category><em class="fas fa-folder-open fa-lg"></em></a></li><li><a href=/search id=Search><em class="fas fa-search fa-lg"></em></a></li><li><a href=/archives id=Archives><em class="fas fa-archive fa-lg"></em></a></li></ul></div></nav><div class=intro-header><div class=container><div class=logs-heading><h1>Daily/2021/01/16</h1></div></div></div></header><div class=container role=main><article class=article class=blog-post><h1 id=todo>Todo</h1><table><thead><tr><th>Todo</th><th>Done</th></tr></thead><tbody><tr><td>daily のログのテンプレート作る</td><td>o</td></tr><tr><td>elasticsearch の検索優先度の検証したい</td><td>-</td></tr></tbody></table><h1 id=log>Log</h1><h2 id=daily-のログのテンプレート作る>daily のログのテンプレート作る</h2><p>モニターが増えたのでなるべく作業ログを残すようにしたい。</p><p>とりあえず hugo にはテンプレートを作る機能があったと思うので、簡素なものを反映してみようと思う。</p><p><a href=https://gohugo.io/content-management/archetypes/>ここ</a> によると、<code>archetypes</code> の下に <code>[type].md</code> というファイル名で作成して、<code>hugo new [type]/[title].md</code>のように生成すれば良いらしい。</p><p>試しに <code>archetypes/logs.md</code> を作成する。</p><pre><code>---
title: &quot;{{ replace .Name &quot;-&quot; &quot;/&quot; | title }}&quot;
date: {{ .Date }}
draft: true
---

# Todo

| Todo | Done |
| ---- | ---- |
|      |      |

# Log

## [Todo]

## [Todo]

## 参考
</code></pre><p>そして以下のコマンドを実行。</p><pre><code>hugo new logs/daily-2021-01-16.md
</code></pre><p>すると、以下のファイルは生成された。</p><pre><code>---
title: &quot;Daily/2021/01/16&quot;
date: 2021-01-16T01:08:04+09:00
draft: true
---

# Todo

| Todo | Done |
| ---- | ---- |
|      |      |

# Log

## [Todo]

## [Todo]

## 参考
</code></pre><p>が、hugo serve で確認すると、記事一覧には出てこない。デフォルトは posts のみリストされるようになっているっぽい。</p><p>調べていたら<a href=https://blog.balloon.im/2019/08/hugo-0.57.0-%E6%9B%B4%E6%96%B0%E5%BE%8Cposts-%E3%81%AE%E3%81%BF%E3%81%8C%E8%A1%A8%E7%A4%BA%E3%81%95%E3%82%8C%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%AA%E3%81%A3%E3%81%9F%E5%A0%B4%E5%90%88/>このブログ</a>を見かけたので、使っているテーマの中を確認。該当行はこう。</p><pre><code>        {{ $pag := .Paginate (where site.RegularPages &quot;Type&quot; &quot;in&quot; site.Params.mainSections) }}
</code></pre><p>たぶん <code>site.Params.mainSections</code> に <code>logs</code> を追加できれば良さそう。<a href=https://gohugo.io/variables/site/>ここ</a>を見る限りでは、普通に toml に設定増やせば良い感じ。</p><pre><code>[params]
  mainSections = [&quot;posts&quot;, &quot;logs&quot;]
</code></pre><p>これで記事一覧に出たので完了。
この記事を生成された logs の下のファイルに丸コピする。</p><p>最後に Makefile に以下のコマンドを登録しておくと楽。</p><pre><code>l::
	hugo new logs/daily-$$(date +%Y-%m-%d).md
</code></pre><p>これで、以下のコマンドでその日のファイルが作れるようになる。</p><pre><code>$ make l
hugo new logs/daily-$(date +%Y-%m-%d).md
Error: /Users/sat8bit/Works/src/github.com/sat8bit/sat8bit.github.io/content/logs/daily-2021-01-16.md already exists
make: *** [l] Error 255
</code></pre><h2 id=elasticsearch-の優先度の検証>elasticsearch の優先度の検証</h2><p>elasticsearch の全文検索を使って複数のフィールドを対象に検索をかけているが、「フィールド A に含まれているのが最優先」「フィールド B に含まれているもの」「フィールド C に含まれているもの」「それぞれ日付ソート」みたいにしたい要望を受けたので、調査ログを残す。
実装ログはなし。</p><p><a href=https://techblog.recochoku.jp/5810>ここ</a> によると、match のときに boost をかけることでできるそう。

ただ、score によるものになってしまうので、うまくハンドリングできない？うまく算出できる？</p><p>いっそのこと 3 ブロックに分けて「A を対象に検索をかけて日付ソート」「B を対象に検索をかけて日付ソート」、、みたいにした結果をくっつけたほうがうまくいくのではないか。</p><p>重複消したりしないといけないのと、重複消したりしたら <code>Hits</code> とかがうまく活かせないかも。</p><p>スコアがうまく算出できないか少し時間かけて考えることにする。</p><h2 id=next>Next</h2><ul><li>スコアを吐き出す計算式考える</li><li>URL を paste したら <code>[ここ](URL)</code> みたいに貼り付けてくれる方法を探したい</li><li>アーキテクチャもう少し考える</li><li>それ以前に普通にコードの実装しないと</li></ul><p>Next Action の欄が欲しくなったのでテンプレートをいじる。</p><h2 id=参考>参考</h2><ul><li><a href=https://gohugo.io/content-management/archetypes/>https://gohugo.io/content-management/archetypes/</a></li><li><a href=https://blog.balloon.im/2019/08/hugo-0.57.0-%E6%9B%B4%E6%96%B0%E5%BE%8Cposts-%E3%81%AE%E3%81%BF%E3%81%8C%E8%A1%A8%E7%A4%BA%E3%81%95%E3%82%8C%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%AA%E3%81%A3%E3%81%9F%E5%A0%B4%E5%90%88/>https://blog.balloon.im/2019/08/hugo-0.57.0-%E6%9B%B4%E6%96%B0%E5%BE%8Cposts-%E3%81%AE%E3%81%BF%E3%81%8C%E8%A1%A8%E7%A4%BA%E3%81%95%E3%82%8C%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%AA%E3%81%A3%E3%81%9F%E5%A0%B4%E5%90%88/</a></li><li><a href=https://gohugo.io/variables/site/>https://gohugo.io/variables/site/</a></li><li><a href=https://techblog.recochoku.jp/5810>https://techblog.recochoku.jp/5810</a></li></ul></article></div><footer><div><a href=https://twitter.com/sat8bit name=Twitter><em class="fab fa-twitter"></em></a><div class=container><p class="credits copyright"><a href=https://sat8bit.github.io/about>Satoshi Koizumi</a>
&nbsp;&copy;
2021
&nbsp;/&nbsp;
<a href=https://sat8bit.github.io/>三日坊主。</a>
&nbsp;&ndash;&nbsp;
<em class="fas fa-moon" id=dark-mode-toggle></em></p><p class="credits theme-by"><a href=https://gohugo.io>Hugo</a>&nbsp;
<a href=https://github.com/matsuyoshi30/harbor>Harbor</a></p></div></footer></body></html>