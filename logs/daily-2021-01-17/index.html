<!DOCTYPE html>
<html lang="ja"><meta charset="utf-8"><meta name="generator" content="Hugo 0.79.1" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name="color-scheme" content="light dark">
<meta name="supported-color-schemes" content="light dark"><title>Daily/2021/01/17&nbsp;&ndash;&nbsp;三日坊主。</title><link rel="stylesheet" href="/css/core.min.f50770753e7b4a1cf823b8241022bf5a6908ecbc3cfcba59bfb76af28f94cceda372fd3dad1f0b6fb6592fd79f9fc1f3.css" integrity="sha384-9QdwdT57Shz4I7gkECK/WmkI7Lw8/LpZv7dq8o&#43;UzO2jcv09rR8Lb7ZZL9efn8Hz"><meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Daily/2021/01/17" /><body><section id="header">
    <div class="header wrap"><span class="header left-side"><a class="site home" href="/"><span class="site name">三日坊主。</span></a></span>
        <span class="header right-side"><div class="nav wrap"><nav class="nav"><a class="nav item" href="/categories/">カテゴリー</a><a class="nav item" href="/tags/">タグ</a></nav></div></span></div></section><section id="content"><div class="article-container"><section class="article header">
    <h1 class="article title">Daily/2021/01/17</h1><p class="article date">2021-01-17</p></section><article class="article markdown-body"><h1 id="todo">Todo</h1>
<table>
<thead>
<tr>
<th>Todo</th>
<th>Done</th>
</tr>
</thead>
<tbody>
<tr>
<td>hugo の先日の log が出てない件の確認</td>
<td>o</td>
</tr>
<tr>
<td>Github Actions を使って hugo build + push を行う</td>
<td>o</td>
</tr>
<tr>
<td>コーディングする</td>
<td></td>
</tr>
</tbody>
</table>
<h1 id="log">Log</h1>
<h2 id="hugo-の先日の-log-が出てない件の確認">hugo の先日の log が出てない件の確認</h2>
<p>テンプレートの draft が何故か true のまま残ってた。ただのログなので default を false に変更。</p>
<p>と思ったけど draft の default が false っぽいので削除すれば良さそう。</p>
<h2 id="github-actions-を使って-hugo-build--push-を行う">Github Actions を使って hugo build + push を行う</h2>
<p>今手元で build して push してるけどめんどくさいので、Github Actions を使って build した後 github に push したことがないので、やってみる。</p>
<p>まずは <a href="https://docs.github.com/ja/actions/reference/workflow-syntax-for-github-actions"target="_blank" rel="noopener noreferrer">公式ドキュメント</a>
 を見ながらビルドまで作ってみる。</p>
<h3 id="job-と-step">Job と Step</h3>
<p>Job とその下に Step がある。</p>
<p>こういうの大体どういう区切りで使うか迷うので、まとめておく。</p>
<ul>
<li>Container Image が Job 単位でしか設定できなさそう</li>
<li>Job は並列実行（逐次にする場合は needs を指定する）。Steps は逐次実行。</li>
</ul>
<h3 id="stepuses">Step.uses</h3>
<blockquote>
<p>ジョブでステップの一部として実行されるアクションを選択します。 アクションとは、再利用可能なコードの単位です。 ワークフロー、パブリックリポジトリ、または公開されている Docker コンテナイメージと同じリポジトリで定義されているアクションを使用できます。</p>
</blockquote>
<p>再利用可能な actions 一覧は <a href="https://github.com/actions"target="_blank" rel="noopener noreferrer">ここ</a>
。</p>
<p>action.yml を見れば作り方もわかりそう？</p>
<h3 id="strategy">Strategy</h3>
<p>Job のビルドをマトリクスでやるときに使うっぽい。複数 OS バージョンとか。</p>
<ul>
<li>OS バージョンをマトリクスする場合は <code>runs-on</code> でやる必要がある。</li>
<li>それ以外は <code>${{matrics.変数名}}</code> みたいに使えば良い。</li>
<li><code>include</code> key を使うと、マトリクスの変数をセットにできるっぽい？</li>
<li>max-parallel で Job を並列化できる</li>
</ul>
<p>良さそう。今回は使わないので必要になったときに。</p>
<h3 id="service">Service</h3>
<blockquote>
<p>ワークフロー中のジョブのためのサービスコンテナをホストするために使われます。 サービスコンテナは、データベースや Redis のようなキャッシュサービスの作成に役立ちます。 ランナーは自動的に Docker ネットワークを作成し、サービスコンテナのライフサイクルを管理します。</p>
</blockquote>
<p>ワークフロー中でキャッシュとか一時的に必要になったときの話かな。
使わなそうなので保留。必要そうになったときに調べる。</p>
<h3 id="とか調べてたら">とか調べてたら・・・</h3>
<p>既に <a href="https://github.com/peaceiris/actions-hugo"target="_blank" rel="noopener noreferrer">actions を作ってくれてる方がいた</a>
。すごいありがたい。</p>
<p>沿って作ってみる。内容は上のリンクのコピペなので割愛します。</p>
<p>master branch の docs 配下を GitHub Pages に設定してたので、これを gh-pages の / に変更して終わり。</p>
<p>（勉強になったけど結局最終的に導入して終わりになってしまった。）</p>
<h2 id="コーディングする">コーディングする</h2>
<h3 id="goland-でできて-vscode-でできないこと">Goland でできて VSCode でできないこと</h3>
<p>もともと Goland を使っていたんだけど、ライセンスが切れるタイミングで VSCode
い移ろうとしている。</p>
<p>一個困っているのが、</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Hogable</span> <span style="color:#66d9ef">interface</span> {
    <span style="color:#a6e22e">Hoge</span>()
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewHogable</span>() <span style="color:#a6e22e">Hogable</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">hoge</span>{}
}

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">hoge</span> <span style="color:#66d9ef">struct</span> {}
</code></pre></div><p>みたいなコードを書いたときに、<code>&amp;hoge{}</code> に赤線が引かれるけど、ここから implement method みたいなことができない。
Goland のときは、struct の下に</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#f92672">*</span><span style="color:#a6e22e">hoge</span>) <span style="color:#a6e22e">Hoge</span>() {
    panic(<span style="color:#e6db74">&#34;not implemented&#34;</span>)
}
</code></pre></div><p>みたいのを生やしてくれた。なんかうまくやれば作れるのかしら。</p>
<ul>
<li><a href="https://yoshinorin.net/2018/05/23/vscode-extension-develop/">https://yoshinorin.net/2018/05/23/vscode-extension-develop/</a></li>
</ul>
<p>LSP の方も見てたけどだいぶ大変そう。</p>
<ul>
<li><a href="https://microsoft.github.io/language-server-protocol/specification">https://microsoft.github.io/language-server-protocol/specification</a></li>
<li><a href="https://qiita.com/atsushieno/items/ce31df9bd88e98eec5c4">https://qiita.com/atsushieno/items/ce31df9bd88e98eec5c4</a></li>
<li></li>
</ul>
<p>一旦このへんで引き返す。</p>
<p>と思ったけど引き返せなくて調べてたら <code>Go: Generate Interface Stubs</code> があるとのこと。</p>
<h3 id="vscode-で設定してない-goroot-が使われている件">VSCode で設定してない GOROOT が使われている件</h3>
<p><code>Go: Generate Interface Stubs</code> の存在を知ったので実行してみるが、エラー。
<img  src="images/2021-01-18-00-37-49.png"
        alt/></p>
<p>そもそも <code>1.12.5</code> なんて今は使ってないのになんでだ。</p>
<p>設定がまずかったのではなく <code>$ go get -u github.com/josharian/impl</code> が足りてなかったらしい。</p>
<p>もしかしたら、 1.12.5 時代に入れた <code>impl</code> を呼び出しに行っていたのかも。<code>go</code> のバージョンが変わるたびに入れる必要ありそう？</p>
<p>一応生成できるようにはなった。 Code Action あたりでできると良いな</p>
<h3 id="protobuf-のコンパイルで使うパッケージを最新化">protobuf のコンパイルで使うパッケージを最新化</h3>
<p>久しぶりに最新化してたら以下のエラーにぶつかった。</p>
<pre><code>$ GO111MODULE=&quot;off&quot; go get -u github.com/grpc-ecosystem/grpc-gateway/protoc-gen-grpc-gateway
package google.golang.org/genproto/googleapis/api/annotations: google.golang.org/genproto is a custom import path for https://github.com/googleapis/go-genproto, but /Users/sat8bit/Works/src/google.golang.org/genproto is checked out from https://github.com/google/go-genproto
</code></pre><p>何事かと思ったけど、結局 <code>google.golang.org/genproto</code> のソースが <code>https://github.com/google/go-genproto</code> から <code>https://github.com/googleapis/go-genproto</code> に変わってるだけの話だった。</p>
<p>もともとあった <code>/Users/sat8bit/Works/src/google.golang.org/genproto</code> を削除して解決。</p>
<p>次にこんなエラー。</p>
<pre><code>package github.com/grpc-ecosystem/grpc-gateway/protoc-gen-swagger: cannot find package &quot;github.com/grpc-ecosystem/grpc-gateway/protoc-gen-swagger&quot; in any of:
</code></pre><p>grpc-gateway から swagger の json を吐き出してたんだけど、それ用のパッケージがなくなってた。</p>
<p>確認に行ったら、<code>protoc-gen-swagger</code> から <code>protoc-gen-openapiv2</code> に変わったみたい。</p>
<p>swagger で使う json 自体は、openapiv2 フォーマットであって、swagger 専用フォーマットじゃないらしい。</p>
<p>その結果こう。</p>
<pre><code>github.com/grpc-ecosystem/grpc-gateway/protoc-gen-swagger/options/annotations.proto: File not found.
</code></pre><p><code>sed</code> で一括書き換えを実施。</p>
<pre><code>$ find proto -type f | xargs sed -i '.bk' 's/protoc_gen_swagger/protoc_gen_openapiv2/g'
$ find proto -type f | xargs sed -i '.bk' 's/protoc-gen-swagger/protoc-gen-openapiv2/g'
$ find proto -name &quot;*.bk&quot; | xargs rm
</code></pre><h2 id="その他作業中に発生したこと">その他作業中に発生したこと</h2>
<h3 id="zsh-の-ctrl--a-について">zsh の Ctrl + A について</h3>
<p>bash から zsh に乗り換え中なんだけど、Ctrl + A で先頭にいかなくてイライラしてた。</p>
<ul>
<li><a href="https://sotarok.hatenablog.com/entry/20080926/1222368908">https://sotarok.hatenablog.com/entry/20080926/1222368908</a></li>
</ul>
<p>emacs 風バインドだったらしい。</p>
<p>上の記事にある通り、以下を追加して解決。</p>
<pre><code>bindkey -e
</code></pre><h3 id="sed-の--i-オプションについて">sed の -i オプションについて</h3>
<p>ネットでさっと調べて -i オプションを付けた結果、こんなエラーが。</p>
<pre><code> extra characters at the end of p command
</code></pre><p>ちゃんと調べればよかったんだけど、<code>xargs</code> と組み合わせたりしてたせいで変なとこから調べてしまった。</p>
<p>Mac 版の sed では、上書きオプションの <code>-i</code> を使うときは、バックアップファイル用の拡張子が必須だった。</p>
<pre><code>sed -i '.backup'
</code></pre><h2 id="next">Next</h2>
<ul>
<li>コーディング少しやったけど protoc のバージョン変えた影響で壊れてる</li>
<li>pb の init func がないエラーが出てるので明日確認が必要</li>
<li>スコアを吐き出す計算式考える</li>
<li>URL を paste したら <code>[ここ](URL)</code> みたいに貼り付けてくれる方法を探したい</li>
<li>アーキテクチャもう少し考える</li>
</ul>
</article><section class="article labels"><a class="tag" href=/tags/logs/>logs</a></section><section class="article author"><p class="name">Satoshi Koizumi</p><div class="details"><a class="item" href="https://github.com/sat8bit" target="_blank" rel="noopener noreferrer"><span class="iconfont icon-github"></span>&nbsp;sat8bit</a><a class="item" href="https://twitter.com/sat8bit" target="_blank" rel="noopener noreferrer"><span class="iconfont icon-twitter"></span>&nbsp;@sat8bit</a><a class="item" href="mailto:sat8bit@mail.com" target="_blank" rel="noopener noreferrer"><span class="iconfont icon-email"></span>&nbsp;sat8bit@mail.com</a></div>
</section>
</div>
<div class="article bottom"><section class="article navigation"><p><a class="link" href="/logs/daily-2021-01-19/"><span class="iconfont icon-article"></span>Daily/2021/01/19</a></p><p><a class="link" href="/logs/daily-2021-01-16/"><span class="iconfont icon-article"></span>Daily/2021/01/16</a></p></section></div></section><section id="footer"><div class="footer-wrap">
    <p class="copyright">三日坊主。</p>
    <p class="powerby"><span>Powered&nbsp;by&nbsp;</span><a href="https://gohugo.io" 
        target="_blank" rel="noopener noreferrer">Hugo</a><span>&nbsp;&amp;&nbsp;</span><a href="https://themes.gohugo.io/hugo-notepadium/" 
        target="_blank" rel="noopener noreferrer">Notepadium</a></p></div>
</section>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-62G1T8FBSZ', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
</body>

</html>